pipeline {
      agent any

      tools {nodejs "NodeJS"}

      parameters{
        booleanParam(name: 'skip_build', defaultValue: true, description: 'Set to true to skip the build stage')
      }
     
      stages {
        stage('Run automated tests') {
            when { expression { params.skip_build != true } }
            steps {
                echo "Running automated tests"
                
                sh 'npm install'
                sh 'npm run cypress:run'
            }            
        }

        stage('SonarQube analysis') {        
            steps {
                echo "SonarQube analysis"
                script {
                    scannerHome = tool 'sonar-scanner';
                }
                withSonarQubeEnv('SonarCloud') { // If you have configured more than one global server connection, you can specify its name
                    sh "${scannerHome}/bin/sonar-scanner"
                }
            }
        }

        stage('JMeter Test') {
            steps {
            // One or more steps need to be included within the steps block.
            echo "JMeter Test"
            }
        }

        stage('Perform manual testing') {
            steps {
            // One or more steps need to be included within the steps block.
            echo "Perform manual testing"
            }
        }

    }

}